<!DOCTYPE HTML>
<html>
<header>
  <script type="text/javascript" src="static/js/index.js"></script>
  <script type="text/javascript" src="static/js/dictionary.js"></script>
  <link rel="stylesheet" href="static/css/index.css">
  <script>
    function getRandInt(max) {
      return Math.floor(Math.random() * max);
    }

    function randomSelect(options, weights) {
      const rad = Math.random();
      for (let i = 0; i < options.length; ++i) {
        if (rad <= weights[i]) {
          return options[i];
        }
      }
      return options[options.length - 1]
    }

    function random_char(num) {
      const index = getRandInt(Object.keys(dictionary[num]).length);
      const char = Object.keys(dictionary[num])[index];
      return char;
    }

    function random_name(num1, num2) {
      return `${random_char(num1)}${random_char(num2)}`;
    }

    function pop_name(num1, num2, total=5) {
      let names = [];
      for (let i = 0; i < total; ++i) {
        const name = random_name(num1, num2);
        names.push(`林${name}: 8, ${num1}, ${num2}`);
      }
      alert(names.join("\n"));
    }

    function random_pop_name_has(num) {
      let names = [];
      let posibles = [];
      for (const choice of choices) {
        if (choice[0] === num || choice[1] === num) {
          posibles.push(choice);
        }
      }

      for (let i = 0; i < 5; ++i) {
        const [num1, num2] = posibles[getRandInt(posibles.length)];
        names.push(`林${random_name(num1, num2)}: 8, ${num1}, ${num2}`);
      }
      alert(names.join("\n"));
    }

    function onloaded() {
      let content = '';
      let weights = [];
      let sum = 0;
      for (const choice of choices) {
        const [num1, num2] = choice;
        const comb = Object.keys(dictionary[num1]).length * Object.keys(dictionary[num2]).length;
        sum += comb;
        weights.push(sum);
        content += `<button class="btn" onclick="pop_name(${num1}, ${num2});">8, ${num1}, ${num2} (${comb})</button>`;
      }
      document.getElementById('choices-btn-group').innerHTML = content;
      weights = weights.map(w => w/sum);

      content = '';
      for (const key in dictionary) {
        const num = parseInt(key);
        const total = Object.keys(dictionary[key]).length;
        content += `<div><button class="btn" onclick="random_pop_name_has(${num});">${key} (${total}):</button>`;
        content += `<span>${Object.keys(dictionary[key]).join(' ')}</span>`;
      }
      document.getElementById('dictionary').innerHTML = content;

      const max_num = 5;
      let names = [];
      for (let i = 0; i < max_num; ++i) {
        const option = randomSelect(choices, weights);
        const num1 = option[0];
        const num2 = option[1];
        const name = random_name(num1, num2);
        names.push(`林${name}: 8, ${num1}, ${num2}`);
      }
      alert(names.join("\n"));
    }

  </script>
  <title>Get the name</title>
</header>

<body onload="onloaded();">
  <div>
    <h3>Good Choices</h3>
    <div id="choices-btn-group">

    </div>
  </div>
  <div>
    <h3>Dictionary</h3>
    <div id="dictionary"></div>
  </div>
  <div>
    <h3>Candidates</h3>
    <p>
      <p>子硯 子清 凡清 彥存 奎安 羿諾 彥翰 奎澔 信安 湛然 俊潤 俊霖 子傑 照斌 夕嵐 川嵐 夕雲 頎斯 奐翰 省學 非零 楷硯 羿安 照涼 思睿 楷智 秋在 </p>
      <p>靖然 靖雲 靖淳 靖皓 靖淵 靖翔</p>
      <p>頌淵 頌雲 頌翔 頌斌 頌傑 </p>
      <p>睦淵 睦雲 睦期 </p>
    </p>
  </div>
  <div>
    <h3>Reference</h3>
    <a href="https://dict.mini.moe.edu.tw/SearchIndex/Stroke" target="_blank">教育部筆畫字典</a>
    <a href="https://naming123.doitwell.tw" target="_blank">三財五行命理查詢</a>
  </div>
</body>

</html>